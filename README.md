# GeoAttend - Sistema Inteligente de Asistencia por Geocerca

## üìã Descripci√≥n del Proyecto

**GeoAttend** es un sistema de registro autom√°tico de asistencia estudiantil mediante geolocalizaci√≥n GPS, implementado con arquitectura de microservicios. El sistema permite a los estudiantes registrar su asistencia a clases √∫nicamente cuando se encuentran f√≠sicamente dentro del aula (verificado por GPS) y durante el horario de clase programado.

### Caracter√≠sticas Principales
- ‚úÖ **Registro de asistencia basado en GPS** con validaci√≥n de proximidad al aula
- ‚úÖ **Validaci√≥n de horarios** - Solo permite registro durante horas de clase (¬±15 min de tolerancia)
- ‚úÖ **Gesti√≥n de cursos y aulas** con ubicaci√≥n GPS y radio de geovalla
- ‚úÖ **M√∫ltiples horarios por curso** con asignaci√≥n de aulas espec√≠ficas
- ‚úÖ **Dashboard web administrativo** para gesti√≥n completa del sistema
- ‚úÖ **Aplicaci√≥n m√≥vil** (React Native/Expo) para estudiantes
- ‚úÖ **Autenticaci√≥n JWT** con roles (admin, teacher, student)
- ‚úÖ **Arquitectura de microservicios** con FastAPI

## üèóÔ∏è Arquitectura del Sistema

### Estilo Arquitect√≥nico
- **Microservicios** con comunicaci√≥n HTTP/REST
- **API Gateway** como punto de entrada √∫nico
- **Base de datos independientes** por microservicio
- **Event-Driven** para notificaciones (en desarrollo)

### Stack Tecnol√≥gico

#### Backend
- **Framework**: FastAPI (Python 3.11+)
- **ORM**: SQLAlchemy 2.0 (Async)
- **Base de Datos**: PostgreSQL 15+
- **Autenticaci√≥n**: JWT (python-jose)
- **Validaci√≥n**: Pydantic v2

#### Frontend Web
- **Framework**: React + TypeScript + Vite
- **UI Components**: shadcn/ui + Tailwind CSS
- **State Management**: React Context
- **Maps**: Leaflet (React-Leaflet)

#### Frontend Mobile
- **Framework**: React Native + Expo
- **Navigation**: React Navigation
- **Maps**: React Native Maps

## üöÄ Instalaci√≥n y Configuraci√≥n

### 1. Prerrequisitos

```bash
# Software requerido
- Python 3.11+
- Node.js 18+
- Docker & Docker Compose
- PostgreSQL 15+ (opcional si usas Docker)
```

### 2. Clonar el Repositorio

```bash
git clone <repository-url>
cd Taller3
```

### 3. Configuraci√≥n de Variables de Entorno

Cada microservicio requiere un archivo `.env`:

#### User Service (.env)
```bash
# user-service/.env
DATABASE_URL=postgresql+asyncpg://postgres:postgres@localhost:5433/user_db
SECRET_KEY=your-secret-key-min-32-chars
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
```

#### Course Service (.env)
```bash
# course-service/.env
DATABASE_URL=postgresql+asyncpg://postgres:postgres@localhost:5434/course_db
SECRET_KEY=your-secret-key-min-32-chars
USER_SERVICE_URL=http://localhost:8001
```

#### Attendance Service (.env)
```bash
# attendance-service/.env
DATABASE_URL=postgresql+asyncpg://postgres:postgres@localhost:5435/attendance_db
SECRET_KEY=your-secret-key-min-32-chars
USER_SERVICE_URL=http://localhost:8001
COURSE_SERVICE_URL=http://localhost:8002
```

#### Notification Service (.env)
```bash
# notification-service/.env
DATABASE_URL=postgresql+asyncpg://postgres:postgres@localhost:5436/notification_db
SECRET_KEY=your-secret-key-min-32-chars
```

#### API Gateway (.env)
```bash
# api-gateway/.env
SECRET_KEY=your-secret-key-min-32-chars
USER_SERVICE_URL=http://localhost:8001
COURSE_SERVICE_URL=http://localhost:8002
ATTENDANCE_SERVICE_URL=http://localhost:8003
NOTIFICATION_SERVICE_URL=http://localhost:8004
```

### 4. Configurar Docker Compose (Opcional)

Si es tu primera vez configurando el proyecto, puedes copiar el archivo de ejemplo:

```bash
# Copiar docker-compose de ejemplo (opcional)
cp docker-compose.yml.example docker-compose.yml

# Editar docker-compose.yml y reemplazar:
# - YOUR_DB_PASSWORD_HERE con tu contrase√±a de base de datos
# - YOUR_SECRET_KEY_MIN_32_CHARS_HERE con tu clave secreta (m√≠nimo 32 caracteres)
# - Configuraci√≥n SMTP si usar√°s notificaciones por email
# - Configuraci√≥n FCM si usar√°s notificaciones push
```

**Nota**: El repositorio ya incluye un `docker-compose.yml` con valores por defecto para desarrollo. Solo usa el `.example` si necesitas una configuraci√≥n personalizada.

### 5. Levantar Bases de Datos con Docker

```bash
# Levantar todas las bases de datos
docker-compose up -d

# Verificar que est√©n corriendo
docker-compose ps

# Ver logs de las bases de datos
docker-compose logs -f user-db course-db attendance-db notification-db
```

Las bases de datos estar√°n disponibles en:
- **user-db**: `localhost:5433`
- **course-db**: `localhost:5434`
- **attendance-db**: `localhost:5435`
- **notification-db**: `localhost:5436`

### 6. Iniciar Microservicios

Abre **5 terminales diferentes** y ejecuta cada servicio:

#### Terminal 1 - User Service (Puerto 8001)
```bash
cd user-service
python -m uvicorn src.main:app --host 0.0.0.0 --port 8001 --reload
```

#### Terminal 2 - Course Service (Puerto 8002)
```bash
cd course-service
python -m uvicorn src.main:app --host 0.0.0.0 --port 8002 --reload
```

#### Terminal 3 - Attendance Service (Puerto 8003)
```bash
cd attendance-service
python -m uvicorn src.main:app --host 0.0.0.0 --port 8003 --reload
```

#### Terminal 4 - Notification Service (Puerto 8004)
```bash
cd notification-service
python -m uvicorn src.main:app --host 0.0.0.0 --port 8004 --reload
```

#### Terminal 5 - API Gateway (Puerto 8000)
```bash
cd api-gateway
python -m uvicorn src.main:app --host 0.0.0.0 --port 8000 --reload
```

### 7. üóÑÔ∏è Inicializar Base de Datos (Primera Vez)

Si est√°s iniciando con bases de datos vac√≠as, ejecuta los scripts de inicializaci√≥n:

```bash
cd database-init

# Windows - Paso 1: Crear admin
1-init-admin.bat

# Windows - Paso 2: Poblar datos
2-populate-db.bat

# Linux/Mac - Paso 1: Crear admin
chmod +x *.sh
./1-init-admin.sh

# Linux/Mac - Paso 2: Poblar datos
./2-populate-db.sh
```

**Datos creados:**
- 1 Administrador (admin@test.com / Password123!)
- 6 Profesores
- 5 Estudiantes
- 8 Aulas con GPS
- 7 Cursos
- 7 Horarios
- 13 Inscripciones

üìñ **Documentaci√≥n completa:** Ver `database-init/README.md`

### 8. Iniciar Frontend Web

```bash
cd web-dashboard
npm install
npm run dev
```

Accede a: **http://localhost:8080**

### 9. Iniciar Aplicaci√≥n M√≥vil (Simulador)

```bash
cd mobile-simulator/geoattend-mobile
npm install
npm start
```

O para web:
```bash
npm run web
```

## üåê Servicios y Puertos

| Servicio | Puerto | Descripci√≥n | URL |
|----------|--------|-------------|-----|
| **API Gateway** | 8000 | Punto de entrada √∫nico | http://localhost:8000 |
| **User Service** | 8001 | Gesti√≥n de usuarios y autenticaci√≥n | http://localhost:8001 |
| **Course Service** | 8002 | Gesti√≥n de cursos, aulas y horarios | http://localhost:8002 |
| **Attendance Service** | 8003 | Procesamiento GPS y asistencias | http://localhost:8003 |
| **Notification Service** | 8004 | Sistema de notificaciones | http://localhost:8004 |
| **Web Dashboard** | 8080 | Panel administrativo | http://localhost:8080 |
| **Mobile Simulator** | 19000 | App m√≥vil (Expo) | http://localhost:19000 |

### Bases de Datos (Docker)
| Base de Datos | Puerto | Usuario | Password |
|--------------|--------|---------|----------|
| user-db | 5433 | postgres | postgres |
| course-db | 5434 | postgres | postgres |
| attendance-db | 5435 | postgres | postgres |
| notification-db | 5436 | postgres | postgres |

## üìä Documentaci√≥n de APIs

### Swagger/OpenAPI
- **User Service**: http://localhost:8001/docs
- **Course Service**: http://localhost:8002/docs
- **Attendance Service**: http://localhost:8003/docs
- **Notification Service**: http://localhost:8004/docs
- **API Gateway**: http://localhost:8000/docs

### Redoc
- **User Service**: http://localhost:8001/redoc
- **Course Service**: http://localhost:8002/redoc
- **Attendance Service**: http://localhost:8003/redoc

## üóÑÔ∏è Estructura de Base de Datos

### User Service (user_db)
- `users` - Informaci√≥n de usuarios (admin, teacher, student)
- `user_profiles` - Perfiles extendidos

### Course Service (course_db)
- `courses` - Cursos acad√©micos
- `classrooms` - Aulas con ubicaci√≥n GPS
- `schedules` - Horarios de clases
- `enrollments` - Inscripciones de estudiantes
- `course_classrooms` - Relaci√≥n cursos-aulas (legacy)

### Attendance Service (attendance_db)
- `gps_events` - Eventos GPS recibidos
- `attendance_records` - Registros de asistencia procesados

### Notification Service (notification_db)
- `notifications` - Notificaciones del sistema

## üîë Credenciales Iniciales

### Usuarios de Prueba

```bash
# Administrador
Email: admin@test.com
Password: Password123!

# Profesor
Email: teacher@test.com
Password: Password123!

# Estudiante
Email: student@test.com
Password: Password123!
```

## üß™ Testing

### Backend
```bash
# Ejecutar tests de un servicio
cd user-service
pytest

# Con coverage
pytest --cov=src tests/

# Tests espec√≠ficos
pytest tests/test_auth.py -v
```

### Frontend Web
```bash
cd web-dashboard
npm test
```

### Mobile
```bash
cd mobile-simulator/geoattend-mobile
npm test
```

## üì± Funcionalidades Implementadas

### ‚úÖ Completadas

#### Dashboard Web (Admin/Teacher)
- ‚úÖ Autenticaci√≥n y autorizaci√≥n por roles
- ‚úÖ Gesti√≥n completa de usuarios (CRUD)
- ‚úÖ Gesti√≥n de cursos con horarios m√∫ltiples
- ‚úÖ Gesti√≥n de aulas con mapa interactivo (Leaflet)
- ‚úÖ Asignaci√≥n de horarios a cursos con aulas espec√≠ficas
- ‚úÖ Gesti√≥n de inscripciones (enrollments)
- ‚úÖ Visualizaci√≥n de asistencias y estad√≠sticas
- ‚úÖ Dashboard con m√©tricas por rol

#### Aplicaci√≥n M√≥vil (Estudiante)
- ‚úÖ Login de estudiantes
- ‚úÖ Visualizaci√≥n de cursos inscritos
- ‚úÖ Visualizaci√≥n de horarios semanales
- ‚úÖ Visualizaci√≥n de historial de asistencias

#### Backend
- ‚úÖ Arquitectura de microservicios con FastAPI
- ‚úÖ Autenticaci√≥n JWT compartida entre servicios
- ‚úÖ API Gateway con proxy a microservicios
- ‚úÖ Validaci√≥n de horarios (¬±15 min tolerancia)
- ‚úÖ CRUD completo de todos los recursos
- ‚úÖ Comunicaci√≥n inter-servicios (HTTP)

### üöß Pendientes (TODOs)

#### Alta Prioridad
- ‚è≥ **Sistema de Notificaciones**
  - Env√≠o de notificaciones push a estudiantes
  - Alertas de asistencia registrada
  - Recordatorios de clases pr√≥ximas
  - Integraci√≥n con Firebase Cloud Messaging

- ‚è≥ **GPS de Proximidad en App M√≥vil**
  - Captura de ubicaci√≥n GPS del dispositivo
  - C√°lculo de distancia al aula
  - Validaci√≥n de proximidad antes de registrar
  - Visualizaci√≥n de mapa con ubicaci√≥n del aula y del estudiante
  - Indicador visual de si est√° dentro del rango

#### Media Prioridad
- ‚è≥ Reportes avanzados (PDF/Excel)
- ‚è≥ Gr√°ficos de estad√≠sticas de asistencia
- ‚è≥ Sistema de justificaciones de ausencias
- ‚è≥ Notificaciones por email
- ‚è≥ Exportaci√≥n de datos

#### Baja Prioridad
- ‚è≥ Modo offline en app m√≥vil
- ‚è≥ Soporte multi-idioma
- ‚è≥ Tema oscuro completo
- ‚è≥ PWA para dashboard web

## üîê Seguridad

- **Autenticaci√≥n**: JWT tokens con SECRET_KEY compartida
- **Autorizaci√≥n**: Role-based access control (admin, teacher, student)
- **CORS**: Configurado para desarrollo (allow all origins)
- **Password Hashing**: bcrypt
- **SQL Injection**: Prevenci√≥n con SQLAlchemy ORM
- **Validaci√≥n**: Pydantic schemas en todos los endpoints

## üìà Monitoreo

### Health Checks
- User Service: http://localhost:8001/health
- Course Service: http://localhost:8002/health
- Attendance Service: http://localhost:8003/health
- Notification Service: http://localhost:8004/health
- API Gateway: http://localhost:8000/health

### Logs
```bash
# Ver logs de un servicio
docker-compose logs -f user-service

# Ver logs de todas las bases de datos
docker-compose logs -f user-db course-db attendance-db notification-db
```

## üö¢ Despliegue

### Desarrollo Local
Seguir las instrucciones de instalaci√≥n arriba.

### Docker Compose (Producci√≥n)
```bash
# Build de todas las im√°genes
docker-compose -f docker-compose.prod.yml build

# Levantar en producci√≥n
docker-compose -f docker-compose.prod.yml up -d
```

## üìö Documentaci√≥n Adicional

- [Arquitectura FastAPI Microservicios](ARQUITECTURA_FASTAPI_MICROSERVICIOS.md)
- [API Reference Completa](API_REFERENCE.md)
- [Gu√≠a de Testing](TESTING_GUIDE.md)
- [Mejores Pr√°cticas FastAPI](FASTAPI_MICROSERVICES_BEST_PRACTICES.md)
- [Migraci√≥n de Bases de Datos](MIGRACION_BASES_DATOS_INDEPENDIENTES.md)

## üõ†Ô∏è Comandos √ötiles

### Docker
```bash
# Levantar solo bases de datos
docker-compose up -d user-db course-db attendance-db notification-db

# Detener todo
docker-compose down

# Limpiar vol√∫menes (‚ö†Ô∏è elimina datos)
docker-compose down -v

# Reconstruir im√°genes
docker-compose build --no-cache
```

### Base de Datos
```bash
# Conectar a una base de datos
docker-compose exec user-db psql -U postgres -d user_db

# Backup de base de datos
docker-compose exec user-db pg_dump -U postgres user_db > backup.sql

# Restore de backup
docker-compose exec -T user-db psql -U postgres user_db < backup.sql
```

### Instalaci√≥n de Dependencias
```bash
# Backend (cada servicio)
cd <service-name>
pip install -r requirements.txt

# Frontend Web
cd web-dashboard
npm install

# Mobile
cd mobile-simulator/geoattend-mobile
npm install
```

## ü§ù Contribuci√≥n

1. Fork el proyecto
2. Crear rama feature (`git checkout -b feature/nueva-funcionalidad`)
3. Commit cambios (`git commit -m 'Agregar nueva funcionalidad'`)
4. Push a la rama (`git push origin feature/nueva-funcionalidad`)
5. Abrir Pull Request

## üë• Equipo

**Taller 3 - Sistemas de Informaci√≥n**
- Sistema de asistencia por geolocalizaci√≥n
- Arquitectura de microservicios con FastAPI
- Aplicaci√≥n m√≥vil con React Native/Expo
- Dashboard administrativo con React

## üìÑ Licencia

Este proyecto es para fines acad√©micos.

---

**üéØ Objetivo**: Demostrar dominio de arquitectura de microservicios, desarrollo full-stack, y sistemas de geolocalizaci√≥n en un sistema real de asistencia acad√©mica.
